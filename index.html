<!DOCTYPE html>
<html dir="ltr" lang="en">
  <head>
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta charset="utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Never cache. Ever. -->
    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />
    <title>Pico y Placa MedellÃ­n</title>
    <meta content="Pico y Placa MedellÃ­n" property="og:site_name" />
    <meta content="Pico y Placa MedellÃ­n" property="og:title" />
    <meta content="website" property="og:type" />
    <meta
      name="description"
      content="InformaciÃ³n diaria del Pico y Placa en MedellÃ­n"
    />
    <meta
      property="og:description"
      content="InformaciÃ³n diaria del Pico y Placa en MedellÃ­n"
    />
    <meta content="http://www.picoyplaca.org" property="og:url" />
    <link
      rel="source"
      href="https://github.com/nhocki/pico-y-placa-medellin"
      title="Source Code"
    />
  </head>

  <body id="container">
    <h1 id="title">Pico y Placa MedellÃ­n</h1>

    <p id="aire">
      <a href="http://www.airemedellin.com/" target="_blank">
        Ver la calidad del aire en MedellÃ­n
      </a>
    </p>

    <p class="centered">
      Seguimos en pandemia. Â¡CuÃ­date!
    </p>
    <section id="day" class="fit"></section>
    <section id="subtitle" class="medium"></section>
    <section id="plates" class="fit"></section>
    <section id="next-date" class="medium"></section>

    <div id="wrap">
      <table id="full"></table>
      <div id="form">
        <a
          href="https://docs.google.com/forms/d/e/1FAIpQLSdOiMNQ7oX1O4QySFOL1mS44Idg4-zykhQrcX7qaY7rEPxQjA/viewform"
          target="_blank"
        >
          Recibe un SMS cuando tengas pico y placa
        </a>
      </div>

      <a
        href="https://github.com/nhocki/pico-y-placa-medellin"
        class="small"
        target="_blank"
      >
        Este sitio es open source
      </a>
    </div>

    <script type="text/javascript">
      var isoDate = function (date) {
        const offset = date.getTimezoneOffset();
        let d = new Date(date.getTime() - offset * 60 * 1000);
        return d.toISOString().split("T")[0];
      };

      const Holidays = new Set();
      Holidays.add(isoDate(new Date("18 Oct 2021")));
      Holidays.add(isoDate(new Date("1 Nov 2021")));
      Holidays.add(isoDate(new Date("15 Nov 2021")));
      Holidays.add(isoDate(new Date("8 Dec 2021")));
      Holidays.add(isoDate(new Date("25 Dec 2021")));

      Holidays.add(isoDate(new Date("1 Jan 2022")));
      Holidays.add(isoDate(new Date("10 Jan 2022")));
      Holidays.add(isoDate(new Date("21 Mar 2022")));
      Holidays.add(isoDate(new Date("14 Apr 2022")));
      Holidays.add(isoDate(new Date("15 Apr 2022")));
      Holidays.add(isoDate(new Date("1 May 2022")));
      Holidays.add(isoDate(new Date("30 May 2022")));
      Holidays.add(isoDate(new Date("20 Jun 2022")));
      Holidays.add(isoDate(new Date("27 Jun 2022")));
      Holidays.add(isoDate(new Date("4 Jul 2022")));
      Holidays.add(isoDate(new Date("20 Jul 2022")));
      Holidays.add(isoDate(new Date("7 Aug 2022")));
      Holidays.add(isoDate(new Date("15 Aug 2022")));
      Holidays.add(isoDate(new Date("17 Oct 2022")));
      Holidays.add(isoDate(new Date("14 Nov 2022")));
      Holidays.add(isoDate(new Date("8 Dec 2022")));
      Holidays.add(isoDate(new Date("25 Dec 2022")));

      var generateSchedule = function(startDate) {
        var lastDate = new Date("2022-02-01 05:00:00Z");
        var digitsIterator = 0
        var schedule = {};
        var digitSchedule = {};

        var digits = [
          0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
          0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
        ];

        while (startDate.getTime() < lastDate.getTime()) {
          if (startDate.getDay() != 0 && startDate.getDay() != 6) {
            if (Holidays.has(isoDate(startDate))) {
              console.log(`Skipping ${isoDate(startDate)} for holidays`);
            }

            let digit = digits[digitsIterator];
            if (!Holidays.has(isoDate(startDate))) {
              console.log(`Setting date: ${isoDate(startDate)}=${digit}`);
              schedule[isoDate(startDate)] = digit;
              digitSchedule[digit] = digitSchedule[digit] || [];
              digitSchedule[digit].push(isoDate(startDate));
            }

            digitsIterator = (digitsIterator + 1) % digits.length;
          }

          startDate.setDate(startDate.getDate() + 1);
        }

        return {
          schedule: schedule,
          digitSchedule: digitSchedule,
        };
      }

      var beginningOfWeek = function (d) {
        let cp = new Date(d);
        return new Date(cp.setDate(cp.getDate() - cp.getDay()));
      };

      var fmt = function (date) {
        return date.toLocaleString("es", {
          weekday: "short",
          day: "2-digit",
          month: "long",
        });
      };

      var buildWeek = function (today, weeks, extraSunday = true) {
        let sunday = beginningOfWeek(today);
        let week = [];
        let end = 7 * weeks + extraSunday;
        for (let day = 0; day < end; day++) {
          let cp = new Date(sunday);
          var d = new Date(cp.setDate(cp.getDate() + day));
          week.push(d);
        }

        return week;
      };

      var nextDate = function(date, schedule) {
        console.log(date, schedule);
        const index = schedule.indexOf(isoDate(date));

        if (index !== -1 && index != schedule.length - 1) {
          return fmt(new Date(schedule[index + 1]));
        }

        return undefined;
      }

      const today = new Date();
      const cars = generateSchedule(new Date("2021-09-06 05:00:00Z"));
      const bikes = generateSchedule(new Date("2021-10-04 05:00:00Z"));
      const digit = cars.schedule[isoDate(today)];
      const bikeDigit = bikes.schedule[isoDate(today)];

      let subtitle = "(solo carros)";
      if (bikeDigit) {
        subtitle = "(carros y motos)";
      }

      document.getElementById("day").innerHTML = fmt(today);
      document.getElementById("subtitle").innerHTML = subtitle;
      document.getElementById("plates").innerHTML = `${digit}`;
      document.getElementById("next-date").innerHTML = `prÃ³xima fecha: ${nextDate(today, cars.digitSchedule[digit])}`;
    </script>

    <style>
      body {
        font-family: helvetica, arial, sans-serif;
      }

      #title {
        font-weight: lighter;
        font-size: 1.5em;
        display: block;
        text-align: center;
        margin: 1em auto 0;
      }

      .fit {
        display: block;
        width: 85%;
        font-size: 3rem;
        text-align: center;
        font-weight: 100;
        margin: 0 auto 0.3em;
      }

      #day {
        margin: 0.5em auto 0.5em;
      }

      #wrap {
        margin-top: 3em;
      }

      #aire {
        text-align: center;
      }

      #full {
        font-size: 0.6em;
        text-align: right;
        margin: 0 auto;
        border-collapse: collapse;
      }

      .small {
        display: block;
        font-size: 0.75em;
        margin: 2em auto;
        text-align: center;
      }

      .medium {
        display: block;
        font-size: 1.20em;
        margin: 2em auto;
        text-align: center;
      }

      .centered {
        display: block;
        font-size: 1.2em;
        margin: 2em auto;
        text-align: center;
      }

      #schedule,
      #full {
        font-size: 1em;
        font-weight: 100;
      }

      #subtitle {
        margin-top: -1em;
      }

      #full td,
      #full th {
        line-height: 2em;
        padding-left: 0.2em 0 0.2em 1.2em;
      }

      #full tr:nth-child(even) {
        background-color: #f2f2f2;
        border-bottom: 1px solid #ddd;
      }

      a,
      a:active,
      a:visited,
      a:hover {
        color: #00f;
        text-decoration: none;
        font-weight: lighter;
      }

      a:hover {
        text-decoration: underline;
      }

      strong a,
      a:hover {
        font-weight: bolder;
      }

      #form {
        display: block;
        font-size: 1.3em;
        margin: 2em auto;
        text-align: center;
      }

      #form a:hover {
        font-weight: lighter;
      }

      @media (min-width: 640px) {
        .fit {
          font-size: 4rem;
        }

        #form:before,
        #form:after {
          content: "ðŸ“±";
        }

        #form:after {
          margin-left: 1px;
        }

        #full td,
        #full th {
          padding: 0;
          padding-left: 1.2em;
        }
      }

      @media (max-width: 639px) {
        .fit {
          font-size: 2rem;
        }

        #form {
          font-size: 1em;
        }

        #full td,
        #full th {
          /* font-size: 1em; */
          padding-left: 1em;
        }
      }
    </style>

    <script type="text/javascript">
      var _gauges = _gauges || [];
      (function () {
        var t = document.createElement("script");
        t.type = "text/javascript";
        t.async = true;
        t.id = "gauges-tracker";
        t.setAttribute("data-site-id", "582021524b2ffa060b015ff8");
        t.setAttribute("data-track-path", "https://track.gaug.es/track.gif");
        t.src = "https://d36ee2fcip1434.cloudfront.net/track.js";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(t, s);
      })();
    </script>

    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "https://www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-87129502-1", "auto");
      ga("send", "pageview");
    </script>
  </body>
</html>
